//Author: "Mustafa RABUS";
//C++ Source: github.com/MustafaRABUS
#include <iostream>
#include <fstream>
#include <string>
#include <sstream>
#include <random>
#include <cmath>

int main() {
    const int cycle=1000; //Sim.for per population. <---------------User Input1/2.
    const int pop=100; // Referance Population. <---------------User Input2/2.
    std::ofstream file("barbarians.csv");
    if (!file.is_open()) {std::cerr << "Can't open file\n";return 1;}
    file <<"Percent Selfish"<<","<<"Percent Mutualist"<<","
        <<"Selfish Victory at 1000 Cycles"<<","
        <<"Mutualist Victory at 1000 Cycles"<<","
        <<"Extinction of Mutualist or Selfish"<<","
        <<"Altruist Survive at 1000 Cycles"<<"\n";
    double norm;
    double probs;
    double probm;
    double proba;
    double totprob;
    int actn;
    int uomn;
    int Ps=0;
    int Pm=0;
    int Ext=0;
    int Aa=0;
    int spercent;
    int mpercent;
    int Ns;
    int Na;
    int Nm;
    std::mt19937 gen(std::random_device{}());
    std::uniform_int_distribution<int> distact(1,100);
    std::uniform_int_distribution<int> distuom(1,4);
    for (int m=1;m<100;m++){
        for (int k=0; k<cycle; k++){ 
            Ns = pop-pop*m/100;
            Nm = pop*m/100;
            Na = pop;
            while(Ns>0 && Nm>0){
                actn=distact(gen);
                totprob=(Ns+Nm+Na)*(Ns+Nm+Na-1)/2;
                probs=Ns*Ns/totprob;
                probm=Ns*Nm/totprob;
                proba=Ns*Na/totprob;
                norm=100/(probs+probm+proba);
                if(actn<=(probs*norm) && Ns>0) { 
                    uomn=distuom(gen);
                    if (uomn<3)Ns=Ns-1;
                    else if (uomn==3 && Ns>2)Ns=Ns-2;
                }
                if(actn>(probs*norm) && actn<=((probs+probm)*norm)) {
                    uomn=distuom(gen);
                    if (uomn==1 && Ns>0)Ns=Ns-1;
                    else if (uomn==2 && Nm>0)Nm=Nm-1;
                    else if (uomn==3 && Ns>0 && Nm>0) {
                        Ns=Ns-1;
                        Nm=Nm-1;}
                }
                if(actn>((probs+probm)*norm) && Na>0) Na=Na-1;
            }
        if (Ns==0 && Nm>0) Pm++;
        if (Nm==0 && Ns>0) Ps++;
        if (Ns==0 && Nm==0) Ext++;
        Aa=Na+Aa;
        }
        Aa=Aa*100/(cycle*pop);
        mpercent=m;
        spercent=100-m;
        file <<spercent<<","<<mpercent<<","<<Ps<<","<<Pm<<","<<Ext<<","<<Aa<<"\n";
        Ps=0;
        Pm=0;
        Ext=0;
        Aa=0;
    }	    
    file.close();
    std::cout<<"Simulation Complated. Outputs Wrote to barbarians.csv"<<"\n";
	return 0;
}
