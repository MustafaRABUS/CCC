//Author: "Mustafa RABUS";
#include <iostream>
#include <fstream>
#include <string>
#include <sstream>
#include <random>
#include <array>
#include <cmath>

int main() {
    std::ofstream file("Ultimatum.csv");
    if (!file.is_open()) {std::cerr << "Can't open file\n";return 1;}
    file <<"Percent Selfish"<<","<<"Percent Mutualist"<<","
	    <<"Average Altruist at 1000 Cycles"<<","
	    <<"Average Selfish at 1000 Cycles"<<","
	    <<"Average Mutualist at 1000 Cycles"<<","
	    <<"Selfish Victory at 1000 Cycles"<<","
	    <<"Mutualist Victory at 1000 Cycles"<<"\n";

    int cycle=1000;
    int range=100;
    int uomn=0;
    int Ps=0;
    int Pm=0;
    int Aa=0;
    int As=0;
    int Am=0;
    int spercent;
    int mpercent;
    int Ns;
    int Na;
    int Nm;
    int NNs;
    int NNa;
    int NNm;
    int Xs[range];
    int Ys[range];
    int Xa[range];
    int Ya[range];
    int Xm[range];
    int Ym[range];
    std::array<int,4> uom = {1,2,3,4};
    std::mt19937 gen(std::random_device{}());
    std::uniform_int_distribution<int> distuom(0, uom.size() - 1);
    std::uniform_int_distribution<int> distXs(0, range);
    std::uniform_int_distribution<int> distYs(0, range);
    std::uniform_int_distribution<int> distXa(0, range);
    std::uniform_int_distribution<int> distYa(0, range);
    std::uniform_int_distribution<int> distXm(0, range);
    std::uniform_int_distribution<int> distYm(0, range);
    for (int m=1;m<100;m++){
        for (int k=0; k<cycle; k++){ 
            Ns=range-range*m/100;
            Nm=range*m/100;
            Na=range;
            NNs=Ns;
            NNm=Nm;
            NNa=Na;
            for (int i = 0; i < Ns; i++) {Xs[i]=distXs(gen) ;Ys[i]=distYs(gen) ;}
            for (int i = 0; i < Nm; i++) {Xm[i]=distXm(gen) ;Ym[i]=distYm(gen) ;}
            for (int i = 0; i < Na; i++) {Xa[i]=distXa(gen) ;Ya[i]=distYa(gen) ;}
            while(Ns>0 and Nm>0){
                for (int i=0;i<NNs;i++){
                    for (int j=0;j<NNs;j++){
                        if(Xs[i]==Xs[j] and Ys[i]==Ys[j] and i<j and Ns>0) { 
                            uomn=uom[distuom(gen)];
                            if (uomn<3)Ns=Ns-1;
                            else if (uomn==3 and Ns>2)Ns=Ns-2;
                        }
                    }
                }
                for (int i=0;i<NNs;i++){
                    for (int j=0;j<NNm;j++){
                        if(Xs[i]==Xm[j] and Ys[i]==Ym[j]) {
                            uomn=uom[distuom(gen)];
                            if (uomn==1 and Ns>0)Ns=Ns-1;
                            else if (uomn==2 and Nm>0)Nm=Nm-1;
                            else if (uomn==3 and Ns>0 and Nm>0) {
                                Ns=Ns-1;
                                Nm=Nm-1;}
                        }
                    }
                }
                for (int i=0;i<NNs;i++){
                    for (int j=0;j<NNa;j++){
                        if(Xs[i]==Xa[j] and Ys[i]==Ya[j] and Na>0) Na=Na-1;
                    }
                }
                for (int i = 0; i < Ns; i++) {Xs[i]=distXs(gen) ;Ys[i]=distYs(gen) ;}
                for (int i = 0; i < Na; i++) {Xa[i]=distXa(gen) ;Ya[i]=distYa(gen) ;}
                for (int i = 0; i < Nm; i++) {Xm[i]=distXm(gen) ;Ym[i]=distYm(gen) ;}
            }
            if (Ns==0 and Nm>0) Pm++;
            if (Nm==0 and Ns>0) Ps++;
            Aa=Na+Aa;
            As=Ns+As;
            Am=Nm+Am;
        }
        Aa=Aa/cycle;
        As=As/cycle;
        Am=Am/cycle;
        mpercent=m;
        spercent=100-m;
        file <<spercent<<","<<mpercent<<","<<Aa<<","<<As<<","<<Am<<","<<Ps<<","<<Pm<<"\n";
        Ps=0;
        Pm=0;
    }
    file.close();
	return 0;
}
