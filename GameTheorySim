//Author: "Mustafa RABUS";
#include <iostream>
#include <fstream>
#include <string>
#include <sstream>
#include <random>
#include <array>
#include <cmath>

int main() {
    std::ofstream file("Ultimatum.csv");
    if (!file.is_open()) {std::cerr << "Can't open file\n";return 1;}
    file <<"Percent Selfish"<<","<<"Percent Mutualist"<<","
        <<"Average Altruist Survive in Cycles"<<","
        <<"Selfish Victory at 1000 Cycles"<<","
        <<"Mutualist Victory at 1000 Cycles"<<"\n";
    int cycle=1000;
    int range=100;
    int uomn=0;
    int Ps=0;
    int Pm=0;
    int Aa=0;
    int spercent;
    int mpercent;
    int Ns;
    int Na;
    int Nm;
    int NNs;
    int NNa;
    int NNm;
    int Xs[range];
    int Ys[range];
    int Xa[range];
    int Ya[range];
    int Xm[range];
    int Ym[range];
    std::mt19937 gen(std::random_device{}());
    std::uniform_int_distribution<int> distuom(1,4);
    std::uniform_int_distribution<int> distXs(0, range);
    std::uniform_int_distribution<int> distYs(0, range);
    std::uniform_int_distribution<int> distXa(0, range);
    std::uniform_int_distribution<int> distYa(0, range);
    std::uniform_int_distribution<int> distXm(0, range);
    std::uniform_int_distribution<int> distYm(0, range);
    for (int m=1;m<100;m++){
        for (int k=0; k<cycle; k++){ 
            Ns = range-range*m/100;
            Nm = range*m/100;
            Na = range;
            NNs = Ns;
            NNm = Nm;
            NNa = Na;
            for (int i = 0; i < Ns; i++) {Xs[i]=distXs(gen) ;Ys[i]=distYs(gen) ;}
            for (int i = 0; i < Nm; i++) {Xm[i]=distXm(gen) ;Ym[i]=distYm(gen) ;}
            for (int i = 0; i < Na; i++) {Xa[i]=distXa(gen) ;Ya[i]=distYa(gen) ;}
            while(Ns>0 && Nm>0){
                for (int i=0;i<NNs;i++){
                    for (int j=0;j<NNs;j++){
                        if(Xs[i]==Xs[j] && Ys[i]==Ys[j] && i<j && Ns>0) { 
                            uomn=distuom(gen);
                            if (uomn<3)Ns=Ns-1;
                            else if (uomn==3 && Ns>2)Ns=Ns-2;
                        }
                    }
                }
                for (int i=0;i<NNs;i++){
                    for (int j=0;j<NNm;j++){
                        if(Xs[i]==Xm[j] && Ys[i]==Ym[j]) {
                            uomn=distuom(gen);
                            if (uomn==1 && Ns>0)Ns=Ns-1;
                            else if (uomn==2 && Nm>0)Nm=Nm-1;
                            else if (uomn==3 && Ns>0 && Nm>0) {
                                Ns=Ns-1;
                                Nm=Nm-1;}
                        }
                    }
                }
                for (int i=0;i<NNs;i++){
                    for (int j=0;j<NNa;j++){
                        if(Xs[i]==Xa[j] && Ys[i]==Ya[j] && Na>0) Na=Na-1;
                    }
                }
                for (int i = 0; i < Ns; i++) {Xs[i]=distXs(gen) ;Ys[i]=distYs(gen) ;}
                for (int i = 0; i < Na; i++) {Xa[i]=distXa(gen) ;Ya[i]=distYa(gen) ;}
                for (int i = 0; i < Nm; i++) {Xm[i]=distXm(gen) ;Ym[i]=distYm(gen) ;}
            }
            if (Ns==0 && Nm>0) Pm++;
            if (Nm==0 && Ns>0) Ps++;
            Aa=Na+Aa;
        }
        Aa=Aa/cycle;
        mpercent=m;
        spercent=100-m;
        file <<spercent<<","<<mpercent<<","<<Aa<<","<<Ps<<","<<Pm<<"\n";
	    Ps=0;
        Pm=0;
        Aa=0;
    }
    file.close();
	return 0;
}
